# Bug Fixes - January 20, 2025

## Issues Addressed

### 1. Question Packs Not Loading ‚ö†Ô∏è CRITICAL

**Problem**: Question packs were not displaying in the selector dropdown

**Root Cause**: Using `npm run dev` (Vite only) instead of `npm run dev:full` (Vercel dev). The `/api/question-sets` endpoint is a Vercel serverless function that doesn't work with the standard Vite dev server.

**Solution**:

- Added documentation explaining the difference between `npm run dev` and `npm run dev:full`
- Updated README.md with clear warnings about when to use each command
- Created `docs/dev-server-setup.md` with detailed troubleshooting

**How to Fix**:

```bash
# Instead of this (only frontend):
npm run dev

# Use this (frontend + API):
npm run dev:full
```

### 2. Card Buttons Not Clickable

**Problem**: The four new buttons (RESET, FINISHED, üëç, üëé) were too small and not responding to clicks

**Root Cause**:

- Buttons were too small (`px-1.5 py-1`)
- Missing `e.stopPropagation()` to prevent card flip on button click
- Icons were tiny (`w-3 h-3`)

**Solution**:

- Increased button padding: `px-3 py-2` (action buttons), `px-2 py-2` (feedback buttons)
- Added `e.stopPropagation()` to all button click handlers
- Increased icon sizes: `w-4 h-4` for action buttons
- Increased gap between buttons: `gap-2` (action), `gap-1.5` (feedback)
- Made text larger: `text-xs md:text-sm` (action), `text-xs` (feedback)
- Added explicit `cursor-pointer` class

### 3. Wrong RESET Icon

**Problem**: RESET button was using a circular arrow (ArrowsClockwise) instead of an X mark

**Solution**: Changed to X mark icon:

```tsx
// Before:
<ArrowsClockwise className="w-3 h-3" />

// After:
<svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
</svg>
```

## Files Modified

### Core Fixes

1. **src/components/QuestionCard.tsx**

   - Increased button sizes (padding, icons, text)
   - Added `e.stopPropagation()` to all button handlers
   - Changed RESET icon from circular arrow to X mark
   - Improved hover states (`hover:bg-muted/70`)

2. **README.md**
   - Added warning about `npm run dev` vs `npm run dev:full`
   - Updated scripts table with descriptions
   - Highlighted that question packs require `dev:full`

### Documentation

3. **docs/dev-server-setup.md** (NEW)

   - Comprehensive guide on dev server options
   - When to use each command
   - Troubleshooting section for common issues
   - Environment variable requirements

4. **docs/question-card-enhancements.md** (NEW)
   - Complete implementation guide
   - API usage examples
   - Database schema documentation

### Infrastructure

5. **api/user-actions.ts** (NEW)

   - User feedback endpoint
   - Progress tracking endpoint
   - Reset and completion handlers

6. **database/migrations/add-question-feedback.sql** (NEW)

   - `question_feedback` table
   - `user_question_progress` table
   - New columns on `questions` table

7. **database/run-migration.js** (NEW)

   - Migration runner script

8. **package.json**
   - Added `migrate` script

### Translations

9. **src/locales/en.json**

   - Added button labels (RESET, FINISHED)
   - Added success/error messages
   - Added authentication messages

10. **src/locales/hu.json**
    - Added button labels (√öJRA, K√âSZ)
    - Added success/error messages
    - Added authentication messages

## Testing Checklist

### Question Packs

- [ ] Stop any running dev server
- [ ] Run `npm run dev:full` instead of `npm run dev`
- [ ] Wait for Vercel dev to fully start
- [ ] Open http://localhost:5000
- [ ] Verify question pack selector shows packs
- [ ] Click dropdown and verify packs are listed

### Button Functionality

- [ ] Flip a question card
- [ ] Click RESET button - should clear marked answers
- [ ] Click FINISHED button - should mark as completed (requires login)
- [ ] Click üëç button - should vote positively (requires login)
- [ ] Click üëé button - should vote negatively (requires login)
- [ ] Verify buttons don't flip the card when clicked
- [ ] Verify buttons are easy to tap on mobile

### Visual Check

- [ ] RESET button shows X mark icon (not circular arrow)
- [ ] All buttons are large enough to click/tap
- [ ] Button text is readable
- [ ] Buttons have proper spacing
- [ ] Hover states work correctly

## Migration Required

Before the feedback buttons work, you need to run the database migration:

```bash
npm run migrate add-question-feedback.sql
```

This creates:

- `question_feedback` table for thumbs up/down votes
- `user_question_progress` table for tracking answered questions
- New columns on `questions` table for aggregated counts

## Next Steps

1. **Run the migration** to enable feedback functionality
2. **Test on `vercel dev`** to ensure APIs work
3. **Deploy to pre-prod** (push to `main` branch)
4. **Test on humbug-quiz.vercel.app**
5. **Merge to master** for production release

## Known Limitations

- Feedback buttons only visible when logged in
- RESET button clears localStorage (no API call needed)
- FINISHED and feedback buttons require database connection
- Progress tracking per-user (not shared across devices without login)

## Additional Resources

- [Development Server Setup Guide](./dev-server-setup.md)
- [Question Card Enhancements Documentation](./question-card-enhancements.md)
- [Database Schema Documentation](../database/SCHEMA_DOCUMENTATION.md)
